<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>ê´€ë¦¬ì ì¸ì¦ - Playground V3</title>
    <link rel="stylesheet" href="css/style.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.5); display: none; align-items: center; justify-content: center; z-index: 999; backdrop-filter: blur(3px); }
        .modal-box { background: white; padding: 25px; border-radius: 15px; width: 90%; max-width: 500px; box-shadow: 0 10px 25px rgba(0,0,0,0.2); max-height: 80vh; display: flex; flex-direction: column; }
        .user-item { padding: 10px; border-bottom: 1px solid #eee; display: flex; justify-content: space-between; align-items: center; }
        .user-item:hover { background: #f8f9fa; }
        .refresh-btn { cursor: pointer; color: #1877f2; margin-left: 10px; transition: transform 0.3s; }
        .refresh-btn:hover { transform: rotate(180deg); }
        .history-item { background: #f8f9fa; border: 1px solid #eee; padding: 15px; border-radius: 10px; margin-bottom: 10px; }
        .tag-scheduled { background: #ffec99; color: #856404; font-size: 11px; padding: 2px 6px; border-radius: 4px; font-weight: bold; }
        .tag-sent { background: #d4edda; color: #155724; font-size: 11px; padding: 2px 6px; border-radius: 4px; font-weight: bold; }
    </style>
</head>
<body>
    <div class="card admin-container">
        <h3 style="display:flex; align-items:center; justify-content:center;">
            ê´€ë¦¬ì ìŠ¹ì¸ ì„¼í„° 
            <i class="fas fa-sync-alt refresh-btn" onclick="refreshData()" title="ë°ì´í„° ìƒˆë¡œê³ ì¹¨"></i>
        </h3>
        
        <div id="admin-login-box">
            <input id="admin-key-input" type="password" placeholder="ê´€ë¦¬ì ë³´ì•ˆ í‚¤" 
                   onkeyup="if(window.event.keyCode==13){loadAdminRequests()}">
            <button class="btn-primary" onclick="loadAdminRequests()">ì ‘ì†</button>
        </div>

        <div id="pending-list-area" class="hidden">
            <div class="table-wrapper">
                <table>
                    <thead>
                        <tr><th>ì•„ì´ë””</th><th>ë‹‰ë„¤ì„</th><th>ìš”ì²­íƒ€ì…</th><th>ìŠ¹ì¸/ê±°ì ˆ</th></tr>
                    </thead>
                    <tbody id="admin-user-list"></tbody>
                </table>
            </div>

            <div style="background:#fff; border:2px solid #eee; padding:20px; border-radius:15px; margin-top:30px; text-align:left;">
                <h4 style="margin-top:0; color:#1877f2;"><i class="fas fa-paper-plane"></i> ìš°í¸ ë°œì†¡ ì„¼í„°</h4>
                
                <label style="font-size:12px; font-weight:bold; color:#555;">ë°›ëŠ” ì‚¬ëŒ</label>
                <div style="display:flex; gap:5px; margin-bottom:10px;">
                    <input id="mail-receiver-display" type="text" placeholder="ë°›ëŠ” ì‚¬ëŒì„ ì„ íƒí•˜ì„¸ìš”" readonly style="margin:0; background:#f9f9f9; cursor:pointer;" onclick="openUserModal()">
                    <button class="btn-secondary" style="width:80px; margin:0;" onclick="openUserModal()">ì„ íƒ</button>
                </div>

                <input id="mail-title" type="text" placeholder="ìš°í¸ ì œëª©" style="margin-bottom:10px;">
                <textarea id="mail-content" placeholder="ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”..." 
                    style="width:100%; height:80px; padding:10px; border:1px solid #ddd; border-radius:8px; box-sizing:border-box; resize:none; margin-bottom:10px;"></textarea>

                <label style="font-size:12px; font-weight:bold; color:#555;">ì˜ˆì•½ ë°œì†¡ (ë¹„ì›Œë‘ë©´ ì¦‰ì‹œ ì „ì†¡)</label>
                <input id="mail-scheduled" type="datetime-local" style="width:100%; margin-bottom:15px;">

                <div style="display:flex; gap:10px;">
                    <button class="btn-admin" style="margin:0; background:#6c757d;" onclick="openMailHistory()">
                        <i class="fas fa-history"></i> ë‚´ì—­/ì·¨ì†Œ
                    </button>
                    <button class="btn-primary" style="margin:0;" onclick="sendAdminMail()">
                        <i class="fas fa-paper-plane"></i> ìš°í¸ ë³´ë‚´ê¸°
                    </button>
                </div>
            </div>
            
            <div style="background:#f1f3f5; padding:20px; border-radius:15px; margin-top:30px;">
                <h4 style="margin-top:0;">ğŸ”“ ì˜¨ë¼ì¸ DB Browser ì ‘ì†</h4>
                <input id="db-master-key-input" type="password" placeholder="2ì°¨ ë§ˆìŠ¤í„° ë³´ì•ˆ í‚¤"
                       onkeyup="if(window.event.keyCode==13){goToDBManager()}">
                <button class="btn-primary" onclick="goToDBManager()">ë§ˆìŠ¤í„° ëª¨ë“œ ì§„ì…</button>
            </div>
        </div>
        
        <button class="btn-admin" onclick="location.href='index.html'">ë‚˜ê°€ê¸°</button>
    </div>

    <div id="user-modal" class="modal-overlay">
        <div class="modal-box">
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px;">
                <h4 style="margin:0;">ë°›ëŠ” ì‚¬ëŒ ì„ íƒ</h4>
                <span onclick="closeUserModal()" style="cursor:pointer; font-size:20px;">&times;</span>
            </div>
            
            <input type="text" id="user-search" placeholder="ì•„ì´ë”” ë˜ëŠ” ë‹‰ë„¤ì„ ê²€ìƒ‰..." onkeyup="filterUsers()" style="margin-bottom:10px;">
            
            <div style="padding:10px; border-bottom:1px solid #eee; display:flex; align-items:center; gap:10px; background:#f8f9fa;">
                <input type="checkbox" id="check-all" onchange="toggleSelectAll()" style="width:18px; height:18px; margin:0;">
                <label for="check-all" style="font-weight:bold; cursor:pointer;">ì „ì²´ ì„ íƒ</label>
            </div>

            <div id="modal-user-list" style="flex:1; overflow-y:auto; border:1px solid #eee; max-height:300px;">
                </div>

            <button class="btn-primary" onclick="confirmUserSelection()" style="margin-top:15px;">ì„ íƒ ì™„ë£Œ</button>
        </div>
    </div>

    <div id="history-modal" class="modal-overlay">
        <div class="modal-box">
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px;">
                <h4 style="margin:0;">ë°œì†¡ ë‚´ì—­ ê´€ë¦¬</h4>
                <span onclick="closeHistoryModal()" style="cursor:pointer; font-size:20px;">&times;</span>
            </div>
            <div id="mail-history-list" style="flex:1; overflow-y:auto; max-height:400px;">
                <p style="color:#999; text-align:center;">ë¡œë”© ì¤‘...</p>
            </div>
        </div>
    </div>
    
    <script src="js/admin.js?v=4"></script>
</body>
</html>