<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>DB Manager</title>
    <script>
        if (!sessionStorage.getItem('dbKey') || !sessionStorage.getItem('adminKey')) {
            alert("잘못된 접근입니다. 관리자 페이지에서 로그인해주세요.");
            location.href = 'admin.html';
        }
    </script>
    <link rel="stylesheet" href="css/style.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        body { padding: 20px; max-width: 1200px; margin: 0 auto; background: #f8f9fa; font-family: 'Pretendard', sans-serif; }
        
        /* [수정] 헤더 컨테이너 스타일 */
        .db-header-container { background: white; padding: 25px; border-radius: 16px; box-shadow: 0 4px 20px rgba(0,0,0,0.05); margin-bottom: 20px; }
        
        /* 1. 제목 + 리프레시 버튼 영역 */
        .title-row { display: flex; align-items: center; gap: 10px; margin-bottom: 20px; }
        .title-row h2 { margin: 0; color: #333; font-size: 1.5rem; display: flex; align-items: center; gap: 10px; }
        
        /* 리프레시 버튼 스타일 (admin.html 스타일 차용) */
        .refresh-btn { 
            cursor: pointer; color: #1877f2; font-size: 18px; 
            transition: transform 0.5s ease; padding: 5px; border-radius: 50%;
        }
        .refresh-btn:hover { background-color: #e7f1ff; transform: rotate(180deg); }

        /* 2. 컨트롤 영역 (드롭다운 + 나가기 버튼) */
        .controls-row { display: flex; justify-content: space-between; align-items: center; gap: 15px; border-top: 1px solid #eee; padding-top: 20px; }
        
        /* 드롭다운 스타일 */
        select#table-select {
            padding: 10px 15px; border: 1px solid #ddd; border-radius: 8px; 
            font-size: 14px; background-color: #fff; min-width: 200px; cursor: pointer;
            outline: none; transition: border-color 0.2s;
        }
        select#table-select:focus { border-color: #1877f2; }

        /* 나가기 버튼 스타일 (위치 이동됨) */
        .btn-exit {
            padding: 10px 20px; background: #6c757d; color: white; border: none; 
            border-radius: 8px; font-weight: bold; cursor: pointer; transition: background 0.2s;
        }
        .btn-exit:hover { background: #5a6268; }

        /* 테이블 영역 스타일 */
        .db-table-section { background: white; padding: 20px; border-radius: 15px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); display: none; margin-top: 20px; animation: fadeIn 0.3s ease-out; }
        .db-table-wrapper { overflow-x: auto; margin-top: 10px; border: 1px solid #eee; border-radius: 8px; }
        .db-table { width: 100%; border-collapse: collapse; font-size: 13px; white-space: nowrap; }
        .db-table th { background-color: #f8f9fa; font-weight: bold; color: #495057; padding: 12px; border-bottom: 2px solid #dee2e6; text-align: left; position: sticky; top: 0; }
        .db-table td { padding: 10px 12px; border-bottom: 1px solid #f1f3f5; color: #333; }
        .db-table tr:hover { background-color: #f8f9fa; }
        .db-table input { width: 100%; min-width: 80px; border: 1px solid transparent; background: transparent; padding: 6px; border-radius: 4px; }
        .db-table input:focus { outline: none; border-color: #1877f2; background: #fff; }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body>

    <div class="db-header-container">
        <div class="title-row">
            <h2><i class="fas fa-database text-blue-600"></i> Database Manager</h2>
            <i class="fas fa-sync-alt refresh-btn" onclick="initializeDBManager()" title="새로고침"></i>
        </div>

        <div class="controls-row">
            <div style="display:flex; align-items:center; gap:10px; flex:1;">
                <label style="font-weight:bold; color:#555; font-size:14px;">View Table:</label>
                <select id="table-select" onchange="showTable(this.value)">
                    <option value="">데이터 불러오는 중...</option>
                </select>
            </div>
            
            <button class="btn-exit" onclick="location.href='admin.html'">
                <i class="fas fa-arrow-left mr-2"></i>나가기
            </button>
        </div>
    </div>

    <div id="loading-msg" style="text-align:center; color:#666; margin-top:50px;">
        <i class="fas fa-circle-notch fa-spin fa-3x text-blue-500 mb-4"></i>
        <p>데이터베이스 연결 중...</p>
    </div>

    <div id="db-content-area"></div>

    <script src="js/admin.js?v=8"></script>
    
    <script>
        window.addEventListener('load', function() {
            initializeDBManager();
        });

        function initializeDBManager() {
            const loadingMsg = document.getElementById('loading-msg');
            const contentArea = document.getElementById('db-content-area');
            const selectBox = document.getElementById('table-select');
            
            // 리프레시 버튼 애니메이션
            const btn = document.querySelector('.refresh-btn');
            if(btn) btn.style.transform = "rotate(360deg)";

            if (typeof window.openDBManager === 'function') {
                if(loadingMsg) loadingMsg.style.display = 'block';
                if(contentArea) contentArea.innerHTML = '';
                // 드롭다운 초기화
                if(selectBox) selectBox.innerHTML = '<option value="">데이터 불러오는 중...</option>';

                window.openDBManager()
                    .then(() => {
                        if(loadingMsg) loadingMsg.style.display = 'none';
                        setTimeout(() => { if(btn) btn.style.transform = "none"; }, 500);
                    })
                    .catch(err => {
                        console.error(err);
                        if(loadingMsg) loadingMsg.innerHTML = "로드 실패 (새로고침 해주세요)";
                    });
            } else {
                if(loadingMsg) loadingMsg.innerHTML = "스크립트 로드 실패";
            }
        }
    </script>
</body>
</html>