<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Dice Defense - Playground V3</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Pretendard:wght@400;600;700;800&display=swap');
        body { font-family: 'Pretendard', sans-serif; overflow: hidden; }
        
        .tab-content { display: none; height: calc(100vh - 140px); overflow-y: auto; }
        .tab-content.active { display: flex; animation: fadeIn 0.3s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }

        .scrollbar-hide::-webkit-scrollbar { display: none; }
        .scrollbar-hide { -ms-overflow-style: none; scrollbar-width: none; }

        #game-canvas { background: #334155; border-radius: 12px; box-shadow: inset 0 0 20px rgba(0,0,0,0.5); }
        
        /* ë“±ê¸‰ë³„ í…ìŠ¤íŠ¸ ì»¬ëŸ¬ */
        .text-Common { color: #94a3b8; }
        .text-Rare { color: #3b82f6; }
        .text-Hero { color: #a855f7; }
        .text-Legend { color: #eab308; }
        
        /* ë“±ê¸‰ë³„ ì¹´ë“œ ë°°ê²½ í…Œë‘ë¦¬ */
        .border-Common { border-color: #e2e8f0; }
        .border-Rare { border-color: #bfdbfe; }
        .border-Hero { border-color: #e9d5ff; }
        .border-Legend { border-color: #fef08a; }
    </style>
</head>
<body class="bg-slate-100 h-screen flex flex-col">

    <nav class="flex-none h-16 bg-white flex justify-between items-center px-4 shadow-sm z-50">
        <div class="flex items-center gap-3">
            <button onclick="location.href='home.html'" class="text-slate-500 hover:text-blue-600 transition-colors">
                <i class="fas fa-arrow-left text-xl"></i>
            </button>
            <h1 class="text-lg font-bold text-slate-800 select-none">Dice Defense</h1>
        </div>
        
        <div class="flex gap-2 text-xs font-bold text-slate-600 bg-slate-100 px-3 py-1.5 rounded-full">
            <div class="flex items-center gap-1"><i class="fas fa-gem text-blue-500"></i> <span id="res-gem">0</span></div>
            <div class="w-px h-3 bg-slate-300"></div>
            <div class="flex items-center gap-1"><i class="fas fa-coins text-yellow-500"></i> <span id="res-gold">0</span></div>
            <div class="w-px h-3 bg-slate-300"></div>
            <div class="flex items-center gap-1"><i class="fas fa-ticket-alt text-purple-500"></i> <span id="res-ticket">0</span></div>
        </div>
    </nav>

    <main class="flex-1 relative w-full max-w-lg mx-auto bg-slate-50 shadow-2xl overflow-hidden md:border-x md:border-slate-200">
        
        <div id="tab-shop" class="tab-content flex-col items-center p-4 space-y-6">
            
            <div class="w-full bg-white rounded-2xl p-4 shadow-sm border border-slate-200">
                <div class="flex items-center justify-between mb-4">
                    <h3 class="font-bold text-slate-800 text-lg">ğŸ² ì£¼ì‚¬ìœ„ ì†Œí™˜</h3>
                    <span class="text-[10px] bg-slate-100 px-2 py-1 rounded text-slate-500">í™•ë¥ : ì¼ë°˜55% / í¬ê·€28% / ì˜ì›…14% / ì „ì„¤3%</span>
                </div>
                
                <div class="flex gap-3">
                    <button onclick="pullGacha(1)" class="flex-1 bg-slate-50 border border-slate-200 rounded-xl p-4 flex flex-col items-center hover:bg-slate-100 active:scale-95 transition-all group relative overflow-hidden">
                        <div class="text-4xl mb-2 group-hover:scale-110 transition-transform">ğŸ“¦</div>
                        <div class="text-sm font-bold text-slate-700">1íšŒ ì†Œí™˜</div>
                        <div class="flex items-center gap-1 mt-1 bg-white px-2 py-1 rounded-full border border-slate-100">
                            <i class="fas fa-ticket-alt text-purple-500 text-xs"></i>
                            <span class="text-xs font-bold text-purple-600">1</span>
                        </div>
                    </button>
                    
                    <button onclick="pullGacha(10)" class="flex-1 bg-gradient-to-br from-indigo-50 to-purple-50 border border-indigo-100 rounded-xl p-4 flex flex-col items-center hover:shadow-md active:scale-95 transition-all group relative overflow-hidden">
                        <div class="absolute top-0 right-0 bg-red-500 text-white text-[10px] font-bold px-2 py-0.5 rounded-bl-lg z-10">Bonus +1</div>
                        <div class="text-4xl mb-2 group-hover:scale-110 transition-transform">ğŸ</div>
                        <div class="text-sm font-bold text-indigo-700">11íšŒ ì†Œí™˜</div>
                        <div class="flex items-center gap-1 mt-1 bg-white px-2 py-1 rounded-full border border-indigo-100">
                            <i class="fas fa-ticket-alt text-purple-500 text-xs"></i>
                            <span class="text-xs font-bold text-purple-600">10</span>
                        </div>
                    </button>
                </div>
            </div>

            <div class="w-full bg-slate-100 rounded-2xl p-4">
                <h3 class="font-bold text-slate-600 text-sm mb-3"><i class="fas fa-gift mr-1"></i> í…ŒìŠ¤íŠ¸ìš© ë¬´ë£Œ ì¶©ì „ì†Œ</h3>
                <div class="grid grid-cols-3 gap-2">
                    <button onclick="addResource('gem', 500)" class="bg-white py-2 rounded-lg text-xs font-bold text-blue-500 shadow-sm active:scale-95 hover:bg-blue-50">ğŸ’ ë³´ì„+500</button>
                    <button onclick="addResource('gold', 1000)" class="bg-white py-2 rounded-lg text-xs font-bold text-yellow-600 shadow-sm active:scale-95 hover:bg-yellow-50">ğŸ’° ê³¨ë“œ+1000</button>
                    <button onclick="addResource('ticket', 10)" class="bg-white py-2 rounded-lg text-xs font-bold text-purple-600 shadow-sm active:scale-95 hover:bg-purple-50">ğŸ« í‹°ì¼“+10</button>
                </div>
            </div>
        </div>

        <div id="tab-deck" class="tab-content flex-col p-4">
            <div class="bg-white rounded-2xl p-4 shadow-sm border border-slate-200 mb-4 opacity-50 relative overflow-hidden">
                <div class="absolute inset-0 flex items-center justify-center bg-white/60 z-10 font-bold text-slate-500 text-sm">
                    ë± í¸ì§‘ ê¸°ëŠ¥ ì¤€ë¹„ ì¤‘
                </div>
                <h3 class="font-bold text-slate-700 mb-3 text-sm">í˜„ì¬ ì¥ì°© ë±</h3>
                <div class="flex justify-between gap-2">
                    <div class="w-14 h-14 bg-slate-100 rounded-lg"></div>
                    <div class="w-14 h-14 bg-slate-100 rounded-lg"></div>
                    <div class="w-14 h-14 bg-slate-100 rounded-lg"></div>
                    <div class="w-14 h-14 bg-slate-100 rounded-lg"></div>
                    <div class="w-14 h-14 bg-slate-100 rounded-lg"></div>
                </div>
            </div>

            <div class="flex-1 overflow-y-auto pb-20">
                <div class="flex justify-between items-end mb-2 px-1">
                    <h4 class="text-xs font-bold text-slate-500">ì „ì²´ ì£¼ì‚¬ìœ„ ëª©ë¡</h4>
                    <button onclick="fetchDiceList()" class="text-[10px] text-blue-500"><i class="fas fa-sync-alt"></i> ìƒˆë¡œê³ ì¹¨</button>
                </div>
                
                <div id="dice-list-container" class="space-y-3">
                    <div class="text-center py-10 text-slate-400 text-sm">ë¡œë”© ì¤‘...</div>
                </div>
            </div>
        </div>

        <div id="tab-battle" class="tab-content active flex-col p-4 relative">
            <div class="flex-1 w-full relative flex flex-col">
                <div id="game-ui-overlay" class="absolute inset-0 pointer-events-none hidden flex-col justify-between p-2 z-10">
                    <div class="flex justify-between items-start">
                        <div class="bg-black/50 text-white px-3 py-1 rounded-full text-xs backdrop-blur-sm">Wave <span id="wave-num" class="text-yellow-400 font-bold">1</span></div>
                        <div class="bg-black/50 text-white px-3 py-1 rounded-full text-xs backdrop-blur-sm">â¤ï¸ 3</div>
                    </div>
                    <div class="flex justify-center items-end pb-2 pointer-events-auto">
                        <button onclick="spawnDice()" class="w-20 h-20 bg-blue-600 rounded-full border-4 border-blue-400 shadow-xl flex flex-col items-center justify-center text-white active:scale-95 transition-transform">
                            <span class="text-xs font-bold">SP</span>
                            <span class="text-lg font-bold" id="sp-cost">10</span>
                        </button>
                    </div>
                </div>
                <canvas id="game-canvas" class="w-full h-full block" width="360" height="640"></canvas>
                <div id="lobby-overlay" class="absolute inset-0 bg-slate-50 flex flex-col items-center justify-center z-20">
                    <div class="text-6xl mb-4 animate-bounce">ğŸ²</div>
                    <h2 class="text-2xl font-extrabold text-slate-800 mb-1">DICE DEFENSE</h2>
                    <p class="text-slate-400 text-sm mb-8">ìµœê³ ì˜ ë±ìœ¼ë¡œ ì ì„ ë§‰ì•„ë‚´ì„¸ìš”!</p>
                    <button onclick="startGame('pve')" class="w-48 py-4 bg-blue-600 hover:bg-blue-700 text-white font-bold rounded-2xl shadow-lg shadow-blue-200 transition-all mb-3 text-lg">
                        <i class="fas fa-play mr-2"></i> ê²Œì„ ì‹œì‘
                    </button>
                </div>
            </div>
        </div>
        
        <div id="tab-event" class="tab-content flex-col p-4"><div class="text-center text-slate-400 mt-10">ì´ë²¤íŠ¸ ì¤€ë¹„ ì¤‘</div></div>
        <div id="tab-clan" class="tab-content flex-col p-4"><div class="text-center text-slate-400 mt-10">í´ëœ ê¸°ëŠ¥ ì¤€ë¹„ ì¤‘</div></div>

    </main>

    <nav class="flex-none h-20 bg-white border-t border-slate-200 flex justify-between items-center px-1 pb-2 shadow-[0_-5px_20px_rgba(0,0,0,0.05)] z-50">
        <button onclick="switchTab('shop')" class="nav-btn flex-1 flex flex-col items-center gap-1 text-slate-400 hover:text-slate-600 transition-colors" data-target="tab-shop">
            <i class="fas fa-store text-xl mb-0.5"></i><span class="text-[10px] font-bold">ìƒì </span>
        </button>
        <button onclick="switchTab('deck')" class="nav-btn flex-1 flex flex-col items-center gap-1 text-slate-400 hover:text-slate-600 transition-colors" data-target="tab-deck">
            <i class="fas fa-th-large text-xl mb-0.5"></i><span class="text-[10px] font-bold">ë±</span>
        </button>
        <div class="w-16 relative flex justify-center">
            <button onclick="switchTab('battle')" class="nav-btn absolute -top-10 w-16 h-16 bg-blue-600 rounded-full flex flex-col items-center justify-center text-white shadow-lg shadow-blue-200 ring-4 ring-white transition-transform active:scale-95" data-target="tab-battle">
                <i class="fas fa-gamepad text-2xl"></i>
            </button>
        </div>
        <button onclick="switchTab('event')" class="nav-btn flex-1 flex flex-col items-center gap-1 text-slate-400 hover:text-slate-600 transition-colors" data-target="tab-event">
            <i class="fas fa-gift text-xl mb-0.5"></i><span class="text-[10px] font-bold">ì´ë²¤íŠ¸</span>
        </button>
        <button onclick="switchTab('clan')" class="nav-btn flex-1 flex flex-col items-center gap-1 text-slate-400 hover:text-slate-600 transition-colors" data-target="tab-clan">
            <i class="fas fa-users text-xl mb-0.5"></i><span class="text-[10px] font-bold">í´ëœ</span>
        </button>
    </nav>

    <div id="gacha-modal" class="fixed inset-0 bg-black/80 hidden z-[100] flex flex-col items-center justify-center p-6 backdrop-blur-sm">
        <h2 class="text-white text-2xl font-bold mb-6 animate-bounce">ğŸ íšë“ ì™„ë£Œ!</h2>
        <div id="gacha-result-grid" class="grid grid-cols-4 gap-3 w-full max-w-sm mb-8">
            </div>
        <button onclick="closeGachaModal()" class="bg-white text-slate-800 font-bold px-8 py-3 rounded-full hover:bg-slate-100 transition-colors shadow-lg">í™•ì¸</button>
    </div>

    <script>
        const API_AUTH = "/api/auth";
        const API_DICE = "/api/dice";
        const myId = sessionStorage.getItem('username');

        // ì£¼ì‚¬ìœ„ ì—ì…‹ ë§¤í•‘ (ì´ëª¨ì§€ ë° ìƒ‰ìƒ)
        const DICE_ASSETS = {
            "fire": { icon: "ğŸ”¥", color: "text-red-500" },
            "electric": { icon: "âš¡", color: "text-yellow-500" },
            "wind": { icon: "ğŸŒªï¸", color: "text-green-500" },
            "poison": { icon: "â˜ ï¸", color: "text-purple-500" },
            "ice": { icon: "ğŸ§Š", color: "text-blue-400" },
            "mining": { icon: "â›ï¸", color: "text-slate-500" },
            "light": { icon: "âœ¨", color: "text-yellow-300" },
            "death": { icon: "ğŸ’€", color: "text-slate-800" },
            "adapt": { icon: "ğŸ­", color: "text-pink-500" },
            "typhoon": { icon: "ğŸŒ€", color: "text-indigo-500" }
        };

        const RARITY_MAP = { "Common": "ì¼ë°˜", "Rare": "í¬ê·€", "Hero": "ì˜ì›…", "Legend": "ì „ì„¤" };

        // --- íƒ­ ì „í™˜ ë¡œì§ ---
        function switchTab(name) {
            document.querySelectorAll('.tab-content').forEach(el => el.classList.remove('active'));
            document.getElementById(`tab-${name}`).classList.add('active');
            
            document.querySelectorAll('.nav-btn').forEach(btn => {
                const isActive = btn.dataset.target === `tab-${name}`;
                if(isActive && !btn.classList.contains('bg-blue-600')) btn.classList.add('text-blue-600');
                else btn.classList.remove('text-blue-600');
            });
            
            if(name === 'deck') fetchDiceList();
        }

        // --- ì¬í™” ê´€ë¦¬ ---
        async function fetchMyResources() {
            if(!myId) return;
            try {
                const res = await fetch(`${API_AUTH}/profile/${myId}`);
                if(res.ok) {
                    const data = await res.json();
                    document.getElementById('res-gem').innerText = data.gems.toLocaleString();
                    document.getElementById('res-gold').innerText = data.gold.toLocaleString();
                    document.getElementById('res-ticket').innerText = data.tickets.toLocaleString();
                }
            } catch(e) {}
        }

        async function addResource(type, amount) {
            const res = await fetch(`${API_AUTH}/add-resource`, {
                method: 'POST', headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ username: myId, type: type, amount: amount })
            });
            if(res.ok) { fetchMyResources(); alert(`ì§€ê¸‰ ì™„ë£Œ!`); }
        }

        // --- ê°€ì±  ì‹œìŠ¤í…œ ---
        async function pullGacha(count) {
            if(!confirm(`í‹°ì¼“ ${count}ì¥ì„ ì‚¬ìš©í•˜ì—¬ ì†Œí™˜í•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) return;
            try {
                const res = await fetch(`${API_DICE}/gacha`, {
                    method: 'POST', headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({ username: myId, draw_count: count })
                });
                const data = await res.json();
                
                if(res.ok) {
                    fetchMyResources(); // ì¬í™” ê°±ì‹ 
                    showGachaResults(data.results);
                } else {
                    alert(data.detail);
                }
            } catch(e) { alert("ì„œë²„ ì˜¤ë¥˜"); }
        }

        function showGachaResults(results) {
            const grid = document.getElementById('gacha-result-grid');
            grid.innerHTML = "";
            results.forEach((item, index) => {
                const asset = DICE_ASSETS[item.id] || { icon: "ğŸ²", color: "text-slate-500" };
                const delay = index * 0.1; // ìˆœì°¨ì  ì• ë‹ˆë©”ì´ì…˜
                
                const el = document.createElement('div');
                el.className = `bg-white rounded-xl p-3 flex flex-col items-center justify-center aspect-square shadow-lg border-2 border-${item.rarity} animate-fade-in`;
                el.style.animationDelay = `${delay}s`;
                el.style.opacity = '0'; // ì• ë‹ˆë©”ì´ì…˜ ì‹œì‘ ì „ ìˆ¨ê¹€
                el.style.animation = `popIn 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275) ${delay}s forwards`;
                
                el.innerHTML = `
                    <div class="text-3xl mb-1 ${asset.color}">${asset.icon}</div>
                    <div class="text-[10px] font-bold text-slate-700 truncate w-full text-center">${item.name}</div>
                    <div class="text-[9px] font-bold text-${item.rarity} mt-0.5">${RARITY_MAP[item.rarity]}</div>
                `;
                grid.appendChild(el);
            });
            document.getElementById('gacha-modal').classList.remove('hidden');
            document.getElementById('gacha-modal').style.display = 'flex';
        }

        function closeGachaModal() {
            document.getElementById('gacha-modal').classList.add('hidden');
        }

        // --- ë±/ì¸ë²¤í† ë¦¬ ---
        async function fetchDiceList() {
            const container = document.getElementById('dice-list-container');
            try {
                const res = await fetch(`${API_DICE}/list/${myId}`);
                if(!res.ok) throw new Error();
                const list = await res.json();
                
                container.innerHTML = list.map(dice => {
                    const asset = DICE_ASSETS[dice.id] || { icon: "ğŸ²", color: "text-slate-500" };
                    const isLocked = dice.level === 0;
                    
                    // ìƒíƒœë³„ ë²„íŠ¼ ë° ê²Œì´ì§€
                    let actionBtn = "";
                    let progressHtml = "";
                    
                    if (isLocked) {
                        // ë¯¸í•´ê¸ˆ ìƒíƒœ
                        if(dice.can_upgrade) {
                            actionBtn = `<button onclick="upgradeDice('${dice.id}')" class="bg-slate-800 text-white text-xs font-bold px-4 py-2 rounded-lg hover:bg-black w-24">ì ê¸ˆ í•´ì œ</button>`;
                        } else {
                            actionBtn = `<button disabled class="bg-slate-200 text-slate-400 text-xs font-bold px-4 py-2 rounded-lg w-24 cursor-not-allowed">ë¯¸ë³´ìœ </button>`;
                        }
                        progressHtml = `<div class="text-[10px] text-slate-400">í•„ìš” ì¹´ë“œ: ${dice.card_count}/${dice.req_card}</div>`;
                    } else {
                        // ë³´ìœ  ìƒíƒœ
                        const progressPercent = Math.min(100, (dice.card_count / dice.req_card) * 100);
                        progressHtml = `
                            <div class="w-full bg-slate-100 h-2 rounded-full overflow-hidden mt-1 relative">
                                <div class="bg-green-500 h-full transition-all duration-500" style="width:${progressPercent}%"></div>
                            </div>
                            <div class="flex justify-between text-[10px] mt-1">
                                <span class="text-slate-500">${dice.card_count} / ${dice.req_card}</span>
                                <span class="text-yellow-600 font-bold">ğŸ’° ${dice.req_gold}</span>
                            </div>
                        `;
                        
                        if(dice.can_upgrade) {
                            actionBtn = `<button onclick="upgradeDice('${dice.id}')" class="bg-green-500 text-white text-xs font-bold px-4 py-2 rounded-lg hover:bg-green-600 w-24 animate-pulse">Lv.UP</button>`;
                        } else {
                            actionBtn = `<button disabled class="bg-slate-100 text-slate-400 text-xs font-bold px-4 py-2 rounded-lg w-24 cursor-not-allowed">ê°•í™” ë¶ˆê°€</button>`;
                        }
                    }

                    return `
                    <div class="bg-white rounded-xl p-3 shadow-sm border border-slate-100 flex items-center gap-4 ${isLocked ? 'opacity-70 grayscale-[0.5]' : ''}">
                        <div class="w-14 h-14 rounded-xl bg-slate-50 flex items-center justify-center text-3xl border border-${dice.rarity}">
                            <span class="${asset.color}">${asset.icon}</span>
                        </div>
                        <div class="flex-1">
                            <div class="flex items-center gap-2">
                                <span class="font-bold text-slate-700 text-sm">${dice.name}</span>
                                <span class="text-[10px] px-1.5 py-0.5 rounded bg-slate-100 font-bold text-${dice.rarity}">${RARITY_MAP[dice.rarity]}</span>
                                ${!isLocked ? `<span class="text-[10px] bg-blue-50 text-blue-600 px-1.5 py-0.5 rounded font-bold">Lv.${dice.level}</span>` : ''}
                            </div>
                            <div class="mt-1">${progressHtml}</div>
                        </div>
                        <div>${actionBtn}</div>
                    </div>`;
                }).join('');
                
            } catch(e) {
                container.innerHTML = `<div class="text-center text-red-400 p-4">ë¡œë“œ ì‹¤íŒ¨</div>`;
            }
        }

        async function upgradeDice(diceId) {
            try {
                const res = await fetch(`${API_DICE}/upgrade`, {
                    method: 'POST', headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({ username: myId, dice_id: diceId })
                });
                const data = await res.json();
                if(res.ok) {
                    // alert(data.message); // ë„ˆë¬´ ìì£¼ ëœ¨ë©´ ê·€ì°®ìœ¼ë¯€ë¡œ ìƒëµ ê°€ëŠ¥
                    fetchMyResources();
                    fetchDiceList(); // ë¦¬ìŠ¤íŠ¸ ê°±ì‹ 
                } else {
                    alert(data.detail);
                }
            } catch(e) { alert("ì˜¤ë¥˜ ë°œìƒ"); }
        }

        // --- ì´ˆê¸°í™” ---
        window.onload = function() {
            if(!myId) { location.href='index.html'; return; }
            fetchMyResources();
        };

        // CSS ì• ë‹ˆë©”ì´ì…˜ ì¶”ê°€
        const style = document.createElement('style');
        style.innerHTML = `
            @keyframes popIn { 
                0% { opacity: 0; transform: scale(0.5); } 
                100% { opacity: 1; transform: scale(1); } 
            }
        `;
        document.head.appendChild(style);

        // --- ê²Œì„ ë¡œì§ (ì›¹ì†Œì¼“) ---
        // (ê¸°ì¡´ ì½”ë“œ ìœ ì§€)
        let socket = null;
        const canvas = document.getElementById('game-canvas');
        const ctx = canvas.getContext('2d');
        const sessionId = new URLSearchParams(window.location.search).get('session') || "test_session";

        function startGame(mode) {
            document.getElementById('lobby-overlay').classList.add('hidden');
            document.getElementById('game-ui-overlay').classList.remove('hidden');
            document.getElementById('game-ui-overlay').style.display = 'flex';
            
            const protocol = window.location.protocol === 'https:' ? 'wss:' : 'ws:';
            const wsUrl = `${protocol}//${window.location.host}/api/dice/ws/game/${sessionId}`; // ê²½ë¡œ ìˆ˜ì •ë¨
            
            socket = new WebSocket(wsUrl);
            socket.onopen = () => { console.log("Connected"); socket.send(JSON.stringify({ type: "JOIN", mode: mode })); };
            socket.onmessage = (e) => { const data = JSON.parse(e.data); if(data.type === 'TICK') renderGame(data); };
            requestAnimationFrame(renderLoop);
        }
        function renderGame(state) {}
        function renderLoop() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            ctx.strokeStyle = '#475569'; ctx.lineWidth = 1;
            const s = canvas.width / 5;
            for(let x=0;x<5;x++) for(let y=0;y<3;y++) ctx.strokeRect(x*s, (canvas.height-s*3)/2+y*s, s, s);
            requestAnimationFrame(renderLoop);
        }
        function spawnDice() { if(socket) socket.send(JSON.stringify({ type: "SPAWN" })); }
    </script>
</body>
</html>